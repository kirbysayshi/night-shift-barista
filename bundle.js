!function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(e,t,r,n,i,a,o,s,u){function c(e){e.preventDefault();var t=l({x:0,y:0},g);if(m)return f(),s();if(1===g.length||h(g)<u)return f(),a();var r=[v(t.x,t.y,0,-1),v(t.x,t.y,1,0),v(t.x,t.y,0,1),v(t.x,t.y,-1,0)],n=Math.max.apply(null,r),i=r.indexOf(n);w[i](),f()}function l(e,t){var r=t[0].x,n=t[0].y;e.x=0,e.y=0;for(var i=0;i<t.length;i++)e.x+=t[i].x-r,e.y+=t[i].y-n;return e.x=e.x/t.length,e.y=e.y/t.length,e}function h(e){for(var t=e[0].x,r=e[0].y,n=0,i=0,a=0;a<e.length;a++)n-=e[a].x-t,i-=e[a].y-r;return Math.sqrt(n*n+i*i)}function d(e){e.preventDefault(),e.stopPropagation();for(var t=e.changedTouches,r=0;r<t.length;r++){var n=t[r];g.push({x:n.pageX,y:n.pageY})}p()}function p(){y&&clearTimeout(y),y=setTimeout(function(){m||(m=!0,o())},200)}function f(e){g.length=0,m=!1,clearTimeout(y),y=null}function v(e,t,r,n){return e*r+t*n}u=u||5;var y=null,m=!1,g=[];e.addEventListener("touchstart",d,!1),e.addEventListener("touchmove",d,!1),e.addEventListener("touchcancel",f,!1),e.addEventListener("touchend",c,!1);var w=[t,r,n,i]}function r(){var e=35208;return function(){var t=e>>1&1,r=e>>9&1,n=t^r;return e=(n<<15|e>>>1)>>>0}}function n(e){return function(){var t=(e()-2)/65532;return t}}function i(e,t,r,n,i){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var o=a.getContext("2d");o.drawImage(e,0,0);for(var s=o.getImageData(0,0,a.width,a.height),u=s.data,c=0;c<u.length;c+=4)u[c+0]=t,u[c+1]=r,u[c+2]=n,u[c+3]=0!==u[c+3]?i:0;return o.putImageData(s,0,0),a}function a(e,t,a){var o,s=12,u=9,c=16,l=(o={},Le(o,z,{x:0,y:5*s,w:s,h:s}),Le(o,X,{x:0,y:4*s,w:s,h:s}),Le(o,$,{x:0,y:3*s,w:s,h:s}),Le(o,Q,{x:0,y:7*s,w:s,h:s}),Le(o,ce,{x:0,y:9*s,w:s,h:s}),Le(o,le,{x:0,y:10*s,w:s,h:s}),Le(o,he,{x:0,y:11*s,w:s,h:s}),Le(o,de,{x:0,y:12*s,w:s,h:s}),Le(o,pe,{x:0,y:14*s,w:s,h:s}),Le(o,fe,{x:0,y:13*s,w:s,h:s}),Le(o,Z,{x:0,y:0*s,w:s,h:s}),Le(o,re,{x:0,y:8*s,w:s,h:s}),Le(o,me,{x:0,y:15*s,w:s,h:s}),Le(o,ge,{x:0,y:99*s,w:s,h:s}),Le(o,ee,{x:0,y:6*s,w:s,h:s}),Le(o,te,{x:0,y:1*s,w:s,h:s}),Le(o,ne,{x:0,y:2*s,w:s,h:s}),Le(o,ie,{x:0,y:20*s,w:s,h:s}),Le(o,ae,{x:0,y:19*s,w:s,h:s}),Le(o,oe,{x:0,y:18*s,w:s,h:s}),Le(o,se,{x:0,y:16*s,w:s,h:s}),Le(o,ue,{x:0,y:17*s,w:s,h:s}),o),h={"0,0-2,8":ie,"3,0-8,9":ae,"0,9-15,15":ae,"8,0-8,1":se,"8,4":ue,"8,6":ue,"8,8":ue,"8,10":ue,"0,9-2,9":oe},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!?&.'-○✗❤★♪:█,",p={2:"ilI!.':,",3:"t1",4:"abcdefghjknopqrsuvxyzL?-",5:"ABCDEFGHJKNOPRSUZ023456789& █",6:"mwMQTVWXY○✗❤★♪"},f=i(a,255,0,0,255),v={debug:!1,view:"BOOT_GAME_VIEW",SPRITE_SIZE:s,SPRITE_COLS:u,SPRITE_ROWS:c,screen:D(e,s*u,s*c,2),tileImage:t,tileSet:l,tileMap:h,fontImage:a,fontImageWhite:a,fontImageBlack:f,fontChrWidths:p,fontChrOrder:d,rng:n(r()),customers:[],orders:[],money:0,reputation:0,totalCustomersServed:0,rareCustomers:[],levelTime:0,levelMaxTime:10*k*100,sun:{position:{start:0,end:0},height:{start:0,end:0},distance:{start:0,end:0}},levelIdx:0,lastCustomerSpawnDT:0,customerNames:["Benjamin","Kira","Julian","Miles","Jadzia","Keiko","Kasidy","Jake","Worf"].map(function(e){return{name:e,hasSpawned:!1}}),levels:[{wants:[{type:de,rarity:0,minimumTime:10*k*10}]},{wants:[{type:ve,rarity:.3,minimumTime:10*k*10,name:"El Hombre de Leche",hasSpawnedOnce:!1},{type:le,rarity:.2,minimumTime:10*k*10},{type:de,rarity:0,minimumTime:10*k*10}]},{wants:[{type:le,rarity:.5,minimumTime:10*k*10},{type:he,rarity:.3,minimumTime:10*k*10},{type:de,rarity:.1,minimumTime:10*k*10}]}],log:[],hasLoggedElapsedForPct:{},stations:{offset:{cols:2,rows:Ee},entries:[{type:Z,name:"The Register"},{type:te,name:"Counter",has:[]},{type:ne,name:"Cup Counter"},{type:$,name:"Hot Water",has:[],timer:{value:0,max:10,hold:!0,active:!1,green:1,red:1}},{type:X,name:"Grouphead",has:[{type:pe}],timer:{value:0,max:30,hold:!1,active:!1,green:.55,red:.95}},{type:z,name:"Milk Steamer",has:[],timer:{value:0,max:30,hold:!0,active:!1,green:.55,red:.95}},{type:ee,name:"Trash / Grounds Chute"},{type:Q,name:"Grinder",setting:20,has:[],timer:{value:0,max:10,hold:!0,active:!1,green:1,red:1}},{type:re,name:"The Counter",has:[]}]},player:{isActivating:!1,position:{cols:0,rows:0},offset:{cols:0,rows:Ee},field:{cols:1,rows:8},has:[]}};return v.sun.position.start=4*v.screen.height,v.sun.position.end=v.screen.height/3,v.sun.distance.start=v.sun.distance.end=v.screen.width/2,v.sun.height.start=v.screen.height/2,v.sun.height.end=3*v.screen.height,v}function o(e){var t=(e.player,e.player.position),r=e.stations.entries,n=r[t.rows];return n}function s(e,t,r){var n=t.has.findIndex(function(e){return e.type===r});if(n!==-1){var i=t.has.splice(n,1);e.has.push(i[0]),e.has.sort(f)}}function u(e,t,r){var n={type:t,sprite:r||t};return e.has.push(n),e.has.sort(f),n}function c(e,t){return e.has.find(function(e){return e.type===t})}function l(e,t){var r=e.has.findIndex(function(e){return e.type===t});if(r!==-1)return e.has.splice(r,1)[0]}function h(e){e.has.length=0}function d(e){return e.has[0].type}function p(e,t){for(var r=function(r){if(e.has.find(function(e){return e.type===t[r]}))return{v:t[r]}},n=0;n<t.length;n++){var i=r(n);if("object"===("undefined"==typeof i?"undefined":Ce(i)))return i.v}return!1}function f(e,t){return e.type===pe||e.type===fe?1:t.type===pe||t.type===fe?-1:0}function v(e,t){if(t.type===xe)return e.view=xe,e;if(t.type===J){var r=a(e.screen.cvs,e.tileImage,e.fontImage);return r.money=e.money,r.reputation=e.reputation,r.totalCustomersServed=e.totalCustomersServed,r.levelIdx=e.view===Ie?0:e.levelIdx+1,r.view=Oe,r}if(t.type===Pe)return e.view=be,e.customers.forEach(function(t){t.paid===!0&&(e.reputation-=Se)}),e;if(t.type===j)return e.debug=!e.debug,e;if(t.type===V){var n=e.player;return n.isActivating=!1,e}if(t.type===K){var i=(e.SPRITE_COLS,{name:t.data.name,wants:t.data.wants,rare:t.data.rare,paid:!1,position:{rows:0,cols:0}});return e.customers.push(i),y(e),e}if(t.type===B){var f=e.player.position.rows-=1;return f<0&&(e.player.position.rows=0),e}if(t.type===H){var v=e.player.position.rows+=1;return v>=e.player.field.rows&&(e.player.position.rows=e.player.field.rows),e}if(t.type===Y){var m=e.log;for(m.push(t.data);m.length>5;)m.shift();return e}if(t.type===U&&e.view===Oe){e.levelTime+=k,e.rng();for(var g=e.player,w=e.stations,E=o(e),S=0;S<w.entries.length;S++){var T=w.entries[S];if(T.timer){if(T.timer.active&&T.timer.value/T.timer.max>=T.timer.green){if(T.type===X&&c(T,ce)&&(l(T,ce),u(T,de)),T.type===X&&c(T,ye)&&(l(T,ye),u(T,le)),T.type===$&&c(T,de)){var I=l(T,de),x=u(T,le);x.wellBrewed=I.wellBrewed}if(T.type===$&&c(T,ce)){var P=l(T,ce),O=u(T,ye,ce);O.wellBrewed=P.wellBrewed}if(T.type===z&&c(T,de)){var b=l(T,de),C=u(T,he);C.wellBrewed=b.wellBrewed}if(T.type===z&&c(T,ce)){var L=l(T,ce),R=u(T,ve,he);R.wellBrewed=L.wellBrewed}}if(T.timer.active&&T.timer.value>=T.timer.max&&(T.timer.active=!1,T.type===Q))return h(T),u(T,fe),e;T.timer.hold&&T.timer.active&&E===T&&g.isActivating&&(T.timer.value+=1),!T.timer.hold&&T.timer.active&&(T.timer.value+=1)}}return e}if(t.type===G){var _=e.player,A=o(e);if(A.type===$){if((c(_,de)||c(_,ce))&&0===A.has.length)return s(A,_,d(_)),e;if(1===A.has.length&&(c(A,de)||c(A,ce)))return A.timer.active=!0,_.isActivating=!0,e;if(A.has.length&&A.timer.active===!1)return s(_,A,d(A)),A.timer.value=0,e}if(A.type===X){if(c(A,fe)&&(c(A,ce)||c(A,ye)))return A.timer.active=!0,_.isActivating=!0,e;if(c(A,fe)&&A.timer.active===!0)return A.timer.active=!1,_.isActivating=!0,e;if(0===_.has.length&&c(A,fe)&&(c(A,de)||c(A,le))){var M=p(A,[de,le]);s(_,A,M);var D=A.timer.value/A.timer.max;return _.has[0].wellBrewed=D<=A.timer.red,l(A,fe),u(A,pe),A.timer.value=0,e}if(c(A,pe)&&0===_.has.length)return s(_,A,pe),e;if((c(_,pe)||c(_,fe))&&!c(A,pe)&&!c(A,fe))return s(A,_,d(_)),e;if((c(_,ce)||c(_,ye))&&!c(A,ce)&&!c(A,le)&&!c(A,de)&&!c(A,he)&&!c(A,ye))return s(A,_,d(_)),e}if(A.type===ne){if(0===_.has.length)return u(_,ce),e;if(c(_,ce))return l(_,ce),e}if(A.type===Z){for(var W=0;W<e.customers.length;W++){var N=e.customers[W];if(!N.paid){e.money+=5,N.paid=!0;break}}return e}if(A.type===Q&&c(A,pe))return _.isActivating=!0,A.timer.active=!0,e;if(A.type===Q&&c(A,fe)&&!_.isActivating)return s(_,A,fe),A.timer.value=0,e;if(A.type===Q&&c(_,pe))return s(A,_,pe),e;if(A.type===ee){if(c(_,fe))return l(_,fe),u(_,pe),e;if(_.has.length&&!c(_,pe))return l(_,d(_)),e}if(A.type===z){if(0===A.has.length&&(c(_,de)||c(_,le)||c(_,ce)))return s(A,_,d(_)),e;if(c(A,de)||c(A,le)||c(A,ce))return _.isActivating=!0,A.timer.active=!0,e;if(0!==A.has.length&&0===_.has.length&&!_.isActivating)return s(_,A,d(A)),A.timer.value=0,e}}if(t.type===q){var F=e.player;if(c(F,de)||c(F,he)||c(F,le)||c(F,ve)||c(F,ye)){var te=d(F),re=l(F,te),ie=e.customers,ae=t.data;re.wellBrewed&&(e.reputation+=Se),e.totalCustomersServed+=1;var oe=ie.splice(ae,1),se=Re(oe,1),ue=se[0];y(e),ue&&ue.rare&&e.rareCustomers.push(ue)}}return e}function y(e){var t=.5,r=e.customers,n=e.SPRITE_COLS;r.forEach(function(e,r){e.position={rows:t+r,cols:Math.floor(n/2)}})}function m(e,t,r,n){var i=e.SPRITE_SIZE,a=e.screen,o=e.tileSet,s=e.tileImage,u=a.scale,c=o[t];a.ctx.drawImage(s,c.x,c.y,c.w,c.h,r*i*u,n*i*u,i*u,i*u)}function g(e,t){for(var r=t.player,n=r.offset,i=r.position,a=i.cols,o=i.rows,s=n.cols+a,u=n.rows+o,c=0;c<r.has.length;c++){var l=r.has[c];m(t,l.sprite||l.type,s+.5,u)}m(t,me,s,u)}function w(e,t,r,n,i,a,o){var s=e.SPRITE_SIZE,u=e.screen,c=u.scale,l=s*c,h=l/3,d=l-h,p=t/r,f=p*l,v=p<a?"rgba(255,255,255,0.8)":p>=a&&p<=o?"rgba(0,255,0,0.8)":"rgba(255,0,0,0.8)";u.ctx.fillStyle=v,u.ctx.fillRect(n*s*c,i*s*c+d,f,h)}function E(e,t){var r=t.stations,n=r.offset,i=r.entries,a=n.cols,o=n.rows;i.forEach(function(e,r){var n=o;if(m(t,e.type,a,n),e.has)for(var i=0;i<e.has.length;i++){var s=e.has[i];m(t,s.sprite||s.type,a-1,n)}e.timer&&e.timer.value>0&&w(t,e.timer.value,e.timer.max,a,n,e.timer.green,e.timer.red),o+=1})}function S(e,t,r,n){var i=arguments.length<=4||void 0===arguments[4]?Te:arguments[4],a=arguments.length<=5||void 0===arguments[5]?1:arguments[5],o=e.SPRITE_SIZE,s=e.fontChrWidths,u=e.fontChrOrder,c=e.fontImageWhite,l=e.fontImageBlack,h=e.screen,d=h.scale,p=i===Te?c:l,f=Object.keys(s).reduce(function(e,t){return s[t].split("").forEach(function(r){return e[r]=parseInt(t,10)}),e},{}),v=o*d*r,y=o*d*n;t.split("").forEach(function(e){for(var t=0,r=0;r<u.length;r++){var n=u[r];if(e===n)break;t+=f[n]}" "!==e&&h.ctx.drawImage(p,t,0,f[e],p.height,v,y,f[e]*a,p.height*a),v+=f[e]*a})}function T(e,t){var r=t.customers,n=t.SPRITE_COLS,i=.5;S(t,"CUSTOMERS",Math.floor(n/2),i+Ee),r.forEach(function(e,r){var n=e.wants,a=(n.type,n.name),o=e.position,s=o.cols,u=o.rows;S(t,(e.paid?"":"█ ")+e.name+": "+a,s,i+u+Ee)})}function I(e,t){for(var r=(t.stations,t.screen,t.tileSet,t.tileMap),n=(t.SPRITE_COLS,t.SPRITE_ROWS,Object.keys(r)),i=0;i<n.length;i++){var a=n[i],o=a;a.indexOf("-")===-1&&(a=a+"-"+a);var s=/(\d+),(\d+)-(\d+),(\d+)/g,u=s.exec(a),c=Re(u,5),l=c[1],h=c[2],d=c[3],p=c[4];l=parseInt(l,10),h=parseInt(h,10),d=parseInt(d,10),p=parseInt(p,10);for(var f=l;f<=d;f++)for(var v=h;v<=p;v++)m(t,r[o],f,v)}}function x(e,t,r,n){return 0==e?t:r*Math.pow(2,10*(e/n-1))+t}function P(e,t){var r=t.SPRITE_COLS,n=t.SPRITE_ROWS,i=t.tileMap,a=t.sun,o=t.screen,s=x(t.levelTime,0,t.levelMaxTime,t.levelMaxTime),u=s/t.levelMaxTime,c=-1*a.distance.start,l=a.position.start+(a.position.end-a.position.start)*u,h=a.height.start+(a.height.end-a.height.start)*u,d=h/2,p=Object.keys(i).filter(function(e){return i[e]===ue||i[e]===se}),f=/(\d+),(\d+)/,v=o.width/r,y=o.height/n;o.ctx.save(),o.ctx.globalCompositeOperation="lighter";for(var m=0;m<p.length;m++){var g=p[m];if(g.indexOf("-")>-1){var w=g.split("-"),E=Re(w,2),S=E[1];p.push(S)}var T=f.exec(g),I=Re(T,3),P=I[1],O=I[2];P=parseInt(P,10),O=parseInt(O,10),o.ctx.fillStyle="rgba(255, 255, 255, "+.1*u+")",o.ctx.beginPath(),o.ctx.moveTo((P+1)*v,O*y),o.ctx.lineTo(c,l-d),o.ctx.lineTo(c,l+d),o.ctx.lineTo((P+1)*v,(O+1)*y),o.ctx.fill()}o.ctx.restore()}function O(e,t){var r=t.screen;t.tileSet,t.tileMap,t.SPRITE_COLS,t.SPRITE_ROWS;r.ctx.fillStyle="rgba(0,0,0,0.7)",r.ctx.fillRect(0,0,r.width,r.height);var n=3;S(t,"Night-Shift",1,2,Te,n),S(t,"Barista",1,3,Te,n);var i=.5,a=6.5;S(t,"You are the sole barista at a 24-hour coffee",1,a+=i),S(t,"shop. Serve your customers the glitching brew",1,a+=i),S(t,"their sleepless brains require, while waiting",1,a+=i),S(t,"for the safety of the sun.",1,a+=i);var o=a+3*i;S(t,"CONTROLS:",1,o+=i),S(t,"UP: Move up",1,o+=i),S(t,"DOWN: Move down",1,o+=i),S(t,"RIGHT: Activate - Pick up - Put down",1,o+=i);var s=1;S(t,"Programming & Design: Drew Petersen",1,14,Te,s),S(t,"Sprites: Lisa Leung",1,14.5,Te,s),S(t,"A 2016 JS13k Competition Entry",1,15,Te,s)}function b(e,t){var r=t.log,n=10,i=.5;S(t,"THOUGHTS",we,n),r.forEach(function(e,r){S(t,e,we,n+=i)})}function C(e,t){var r=t.screen;t.tileSet,t.tileMap,t.SPRITE_COLS,t.SPRITE_ROWS;r.ctx.fillStyle="rgba(0,0,0,0.7)",r.ctx.fillRect(0,0,r.width,r.height);var n=2;S(t,"Weekly",1,2,Te,n),S(t,"Night-Shifts:",1,3,Te,n),S(t,"Complete!",1,4,Te,n);var i=.5,a=4.5;S(t,"❤: "+t.reputation,1,a+=i),S(t,"█: "+t.money,1,a+=i),S(t,"Customers: "+t.totalCustomersServed,1,a+=i);var o=1;S(t,"Thank you for playing!",1,a+=i,Te,o)}function L(e,t){var r=t.screen,n=(t.tileSet,t.tileMap,t.SPRITE_COLS,t.SPRITE_ROWS,t.rareCustomers);r.ctx.fillStyle="rgba(0,0,0,0.7)",r.ctx.fillRect(0,0,r.width,r.height);var i=2;S(t,"Shift Complete!",1,2,Te,i);var a=4;n.length&&(S(t,"Interesting people:",1,a),n.forEach(function(e){S(t,e.name,1,a+=.5)})),a++,S(t,"The next night",1,++a,Te,i),S(t,"... Begins!",1,++a,Te,i)}function R(){Promise.all([W("assets/tiles.png"),W("assets/m05-short.png")]).then(function(e){var r=Re(e,2),n=r[0],i=r[1],o=new M(v,a(window.c,n,i));o.subscribe(function(){var e=o.getState();if(e.debug){var t=window.d;t||(t=document.createElement("pre"),t.id="d",t.style="display:block;position:absolute;color:white;overflow:scroll;z-index:9000;height:100%;width:100%;top:0;left:0",document.body.appendChild(t)),t.innerHTML=JSON.stringify(o.getState(),null,"  ")}_(1,e)});var s=N({drawTime:F,updateTime:k,draw:function(e){},update:function(e){o.dispatch({type:U,data:e}),o.dispatch(_e()),o.dispatch(De()),o.dispatch(Me())}});document.body.addEventListener("keydown",function(e){27===e.which&&(s.stop(),console.log("halt in the name of science")),[37,38,39,40].indexOf(e.which)>-1&&e.preventDefault(),38===e.which&&o.dispatch({type:B}),40===e.which&&o.dispatch({type:H}),39===e.which&&o.dispatch(Ae()),188===e.which&&e.metaKey&&e.shiftKey&&o.dispatch({type:j})},!1),document.body.addEventListener("keyup",function(e){39===e.which&&o.dispatch({type:V})},!1),"ontouchstart"in window&&(window.ipt.style.display="block",window.btnup.addEventListener("touchend",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),o.dispatch({type:B})},!1),window.btndown.addEventListener("touchend",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),o.dispatch({type:H})},!1),window.btnact.addEventListener("touchstart",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),o.dispatch(Ae())},!1),window.btnact.addEventListener("touchend",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),o.dispatch({type:V})},!1),document.body.addEventListener("touchstart",function(e){return e.preventDefault()}),t(document,function(){o.dispatch({type:B})},function(){o.dispatch(Ae()),o.dispatch({type:V})},function(){o.dispatch({type:H})},function(){},function(){o.dispatch(Ae()),o.dispatch({type:V})},function(){o.dispatch(Ae())},function(){o.dispatch({type:V})}))})}function _(e,t){var r=t.screen,n=t.view;r.ctx.clearRect(0,0,r.width,r.height),n===Oe&&(I(e,t),g(e,t),E(e,t),T(e,t),b(e,t),P(e,t)),n===xe&&(I(e,t),E(e,t),L(e,t)),n===Ie&&(I(e,t),E(e,t),O(e,t)),n===be&&(I(e,t),E(e,t),C(e,t))}var A=e(function(e,t){function r(e,t){var r=this,n=t,i=[];this.getState=function(){return n},this.dispatch=function(t){return"function"==typeof t?t(r.dispatch,r.getState):(n=e(n,t),i.forEach(function(e){return e()}),t)},this.subscribe=function(e){return i.push(e),function(){i=i.filter(function(t){return t!==e})}},this.dispatch({type:"@@INIT"})}Object.defineProperty(t,"__esModule",{value:!0}),t.Store=r}),M=A.Store,D=function(e,t,r,n){var i=e.getContext("2d");e.style.margin="0 auto",e.style.display="block";var a="BODY"!==e.parentNode.nodeName?e.parentNode:null;a&&(a.style.margin="0 auto",a.style.display="block"),t<r?(e.style.height="100%",a&&(a.style.height="100%")):(e.style.width="100%",a&&(a.style.width="100%")),t*=n,r*=n,e.width=t,e.height=r,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1;var o={width:t,height:r,cvs:e,ctx:i,scale:n,destroy:function(){Object.keys(o).map(function(e){return delete o[e]})}};return o},W=function(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=r,n.src=e})},N=function(e){var t=e.drawTime,r=e.updateTime,n=e.draw,i=e.update,a=e.panicAt,o=void 0===a?10:a,s=e.onPanic,u=void 0===s?function(){}:s,c=e.onFPS,l=void 0===c?function(){}:c,h=window.performance,d=t,p=r,f=h.now.bind(h),v=window.requestAnimationFrame.bind(window),y=0,m=null,g=f(),w=f(),E=0,S=0;!function I(e){m=v(I);var t=e-g;y+=t,g=e;var r=y-d>=0,a=Math.floor(y/p);if(a>=o)return y=0,g=f(),void u();for(;a-- >0;)y-=p,i(p);r&&n(y/d),E+=1,w+1e3<=e&&(S=.25*E+.75*S,E=0,w=e,l(S))}(f());var T=function(){m&&cancelAnimationFrame(m)};return{stop:T}},F=1e3/60,k=100,U="GAME_TICK",B="SWIPE_UP",H="SWIPE_DOWN",G="ACTIVATE",V="ACTIVATE_CEASE",K="NEW_CUSTOMER",j="DEBUG_TOGGLE",Y="LOG_ENTRY_ADDED",J="NEXT_LEVEL",q="CUSTOMER_DRINK_READY",Z="ORDER_COUNTER",z="STEAMER",X="GROUPHEAD",Q="GRINDER",$="HOT_WATER",ee="TRASH",te="EMPTY_COUNTER",re="PICKUP_COUNTER",ne="CUP_COUNTER",ie="COUNTER_FLOOR",ae="SHOP_FLOOR",oe="DECORATIVE_PLANT",se="SHOP_DOOR",ue="SHOP_WINDOW",ce="CLEAN_CUP",le="FILLED_AMERICANO_CUP",he="FILLED_CAPPUCCINO_CUP",de="FILLED_ESPRESSO_CUP",pe="CLEAN_PORTAFILTER",fe="FILLED_PORTAFILTER",ve="FILLED_STEAMED_MILK_CUP",ye="FILLED_HOT_WATER_CUP",me="BARISTA",ge="CHECKMARK",we=.5,Ee=0,Se=10,Te="FONT_COLOR_WHITE",Ie="BOOT_GAME_VIEW",xe="BETWEEN_LEVEL_VIEW",Pe="SHOW_SUMMARY_VIEW",Oe="LEVEL_VIEW",be="SUMMARY_VIEW",Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},Le=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},Re=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(u){i=!0,a=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_e=function(){return function(e,t){var r=t();if(r.view===Oe&&r.levelTime>=r.levelMaxTime)return e(r.levelIdx+1<r.levels.length?{type:xe}:{type:Pe})}},Ae=function(){return function(e,t){var r=t();if(r.view===Oe){var n=o(r),i=r.player;if(i.has.length&&n.type===re){var a=function(){var t=d(i),n=r.customers,a=n.findIndex(function(e){return e.wants.type===t});if(a>-1){var o=n[a];return o.paid?{v:e({type:q,data:a})}:{v:e({type:Y,data:"They need to pay to receive the drink!"})}}}();if("object"===("undefined"==typeof a?"undefined":Ce(a)))return a.v}if(!r.player.isActivating)return e({type:G})}return r.view===Ie?e({type:J}):r.view===xe?e({type:J}):void 0}},Me=function(){return function(e,t){var r=t(),n=r.levelTime/r.levelMaxTime,i=n.toPrecision(2);if(!r.hasLoggedElapsedForPct[i])return"0.25"===i?(e({type:Y,data:"Phew, a quarter through my shift!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.5"===i?(e({type:Y,data:"Halfway through my shift!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.75"===i?(e({type:Y,data:"Just a quarter of my shift left!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.91"===i?(e({type:Y,data:"I think I can see daylight!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.92"===i?(e({type:Y,data:"What is 'daylight'?"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.93"===i?(e({type:Y,data:"I remember now!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.94"===i?(e({type:Y,data:"Daylight is definitely approaching!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.95"===i?(e({type:Y,data:"It's getting so bright!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.96"===i?(e({type:Y,data:"So bright..."}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.97"===i?(e({type:Y,data:"So sleepy..."}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.98"===i?(e({type:Y,data:"I can almost smell my bed..."}),void(r.hasLoggedElapsedForPct[i]=!0)):"0.99"===i?(e({type:Y,data:"Almost time to close up!"}),void(r.hasLoggedElapsedForPct[i]=!0)):"1"===i?(e({type:Y,data:"Everybody out!"}),void(r.hasLoggedElapsedForPct[i]=!0)):void 0}},De=function(){return function(e,t){var r=t();if(r.view===Oe){var n=r.lastCustomerSpawnDT,i=r.levelTime,a=r.rng,o=r.customerNames,s=(r.customers,r.levels[r.levelIdx]),u=0,c=!1;s.wants.forEach(function(t){if(!c&&!t.hasSpawnedOnce&&(0===n&&i>=u||i-n>t.minimumTime)){var s=a();if(s>t.rarity){var l=void 0,h=!1;if(t.name)l=t.name,t.hasSpawnedOnce=!0,h=!0;else{var d=o.filter(function(e){return e.hasSpawned===!1});d.length||(o.forEach(function(e){return e.hasSpawned=!1}),d=o);var p=Math.floor(a()*(d.length-1)),f=d[p];f.hasSpawned=!0,l=f.name}e({type:K,data:{name:l,rare:h,wants:{type:t.type,name:t.type===le?"Americano":t.type===de?"Espresso":t.type===he?"Cappuccino":"??????"}}}),e({type:Y,data:"A new customer walked in!"}),0===r.lastCustomerSpawnDT&&e({type:Y,data:"... I'd better take their money █."}),c=!0,r.lastCustomerSpawnDT=i}}})}}};R()}();